<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>01-Go语言 grpc入门教程 - Even - A super concise theme for Hugo</title><meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="lucas"><meta name=description content="go 语言 grpc 入门教程 1: 安装 go 语言 grpc 包 2:安装 protobuf 编译器 2.1 安装 protoc 编译器 2.2 安装编译器 go 语言插件 3: Example 目录结构 4: 定义服务 5: 编译 proto 协议文件 6: 实现服务端代码 7"><meta name=keywords content="Go,GRPC">
<meta name=generator content="Hugo 0.93.1 with theme even">
<link rel=canonical href=https://lppgo.github.io/post/golang/007-go%E8%AF%AD%E8%A8%80-grpc%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="01-Go语言 grpc入门教程">
<meta property="og:description" content="go 语言 grpc 入门教程 1: 安装 go 语言 grpc 包 2:安装 protobuf 编译器 2.1 安装 protoc 编译器 2.2 安装编译器 go 语言插件 3: Example 目录结构 4: 定义服务 5: 编译 proto 协议文件 6: 实现服务端代码 7">
<meta property="og:type" content="article">
<meta property="og:url" content="https://lppgo.github.io/post/golang/007-go%E8%AF%AD%E8%A8%80-grpc%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-04-28T00:00:00+00:00">
<meta property="article:modified_time" content="2022-03-04T10:56:42+08:00">
<meta itemprop=name content="01-Go语言 grpc入门教程">
<meta itemprop=description content="go 语言 grpc 入门教程 1: 安装 go 语言 grpc 包 2:安装 protobuf 编译器 2.1 安装 protoc 编译器 2.2 安装编译器 go 语言插件 3: Example 目录结构 4: 定义服务 5: 编译 proto 协议文件 6: 实现服务端代码 7"><meta itemprop=datePublished content="2021-04-28T00:00:00+00:00">
<meta itemprop=dateModified content="2022-03-04T10:56:42+08:00">
<meta itemprop=wordCount content="2033">
<meta itemprop=keywords content="Go,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="01-Go语言 grpc入门教程">
<meta name=twitter:description content="go 语言 grpc 入门教程 1: 安装 go 语言 grpc 包 2:安装 protobuf 编译器 2.1 安装 protoc 编译器 2.2 安装编译器 go 语言插件 3: Example 目录结构 4: 定义服务 5: 编译 proto 协议文件 6: 实现服务端代码 7"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head><body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>lppgo</a>
</div><div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div></div><nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li></a><a href=/post/>
<li class=mobile-menu-item>Archives</li></a><a href=/categories/>
<li class=mobile-menu-item>Categories</li></a><a href=/tags/>
<li class=mobile-menu-item>Tags</li></a>
</ul></nav><div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>lppgo</a>
</div><nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li></ul></nav></header><main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>01-Go语言 grpc入门教程</h1><div class=post-meta>
<span class=post-time> 2021-04-28 </span>
<div class=post-category>
<a href=/categories/go/> Go </a>
</div></div></header><div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active">
<nav id=TableOfContents>
<ul>
<li><a href=#go-语言-grpc-入门教程>go 语言 grpc 入门教程</a>
<ul>
<li><a href=#1-安装-go-语言-grpc-包>1: 安装 go 语言 grpc 包</a></li><li><a href=#2安装-protobuf-编译器>2:安装 protobuf 编译器</a>
<ul>
<li><a href=#21-安装-protoc-编译器>2.1 安装 protoc 编译器</a></li><li><a href=#22-安装编译器-go-语言插件>2.2 安装编译器 go 语言插件</a></li></ul></li><li><a href=#3-example-目录结构>3: Example 目录结构</a></li><li><a href=#4-定义服务>4: 定义服务</a></li><li><a href=#5-编译-proto-协议文件>5: 编译 proto 协议文件</a></li><li><a href=#6-实现服务端代码>6: 实现服务端代码</a></li><li><a href=#7实现客户端代码>7:实现客户端代码</a></li><li><a href=#8-使用-grpc-gateway>8: 使用 grpc-gateway</a>
<ul>
<li><a href=#81-安装-grpc-hateway>8.1 安装 grpc-hateway</a></li></ul></li><li><a href=#82-修改-xproto-文件>8.2 修改 x.proto 文件</a></li><li><a href=#83-生成-pbgo-代码>8.3 生成 pb.go 代码</a></li></ul></li></ul></nav></div></div><div class=post-content>
<ul>
<li><a href=#go-%E8%AF%AD%E8%A8%80-grpc-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B>go 语言 grpc 入门教程</a>
<ul>
<li><a href=#1-%E5%AE%89%E8%A3%85-go-%E8%AF%AD%E8%A8%80-grpc-%E5%8C%85>1: 安装 go 语言 grpc 包</a></li><li><a href=#2%E5%AE%89%E8%A3%85-protobuf-%E7%BC%96%E8%AF%91%E5%99%A8>2:安装 protobuf 编译器</a>
<ul>
<li><a href=#21-%E5%AE%89%E8%A3%85-protoc-%E7%BC%96%E8%AF%91%E5%99%A8>2.1 安装 protoc 编译器</a></li><li><a href=#22-%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E5%99%A8-go-%E8%AF%AD%E8%A8%80%E6%8F%92%E4%BB%B6>2.2 安装编译器 go 语言插件</a></li></ul></li><li><a href=#3-example-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84>3: Example 目录结构</a></li><li><a href=#4-%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1>4: 定义服务</a></li><li><a href=#5-%E7%BC%96%E8%AF%91-proto-%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6>5: 编译 proto 协议文件</a></li><li><a href=#6-%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BB%A3%E7%A0%81>6: 实现服务端代码</a></li><li><a href=#7%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81>7:实现客户端代码</a></li><li><a href=#8-%E4%BD%BF%E7%94%A8-grpc-gateway>8: 使用 grpc-gateway</a>
<ul>
<li><a href=#81-%E5%AE%89%E8%A3%85-grpc-hateway>8.1 安装 grpc-hateway</a></li></ul></li><li><a href=#82-%E4%BF%AE%E6%94%B9-xproto-%E6%96%87%E4%BB%B6>8.2 修改 x.proto 文件</a></li><li><a href=#83-%E7%94%9F%E6%88%90-pbgo-%E4%BB%A3%E7%A0%81>8.3 生成 pb.go 代码</a></li></ul></li></ul><h1 id=go-语言-grpc-入门教程>go 语言 grpc 入门教程</h1><blockquote>
<p>前置知识点
1: <a href=https://www.tizi365.com/archives/367.html>protobuf 语法</a>
2: <a href=https://www.tizi365.com/archives/391.html>grpc 核心概念</a></p></blockquote><h2 id=1-安装-go-语言-grpc-包>1: 安装 go 语言 grpc 包</h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=o>-</span><span class=nx>u</span> <span class=o>-</span><span class=nx>v</span> <span class=nx>google</span><span class=p>.</span><span class=nx>golang</span><span class=p>.</span><span class=nx>org</span><span class=o>/</span><span class=nx>grpc</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=2安装-protobuf-编译器>2:安装 protobuf 编译器</h2><h3 id=21-安装-protoc-编译器>2.1 安装 protoc 编译器</h3><p>protobuf 编译器就叫 protoc.</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>到下面github地址</span><span class=err>，</span><span class=nx>根据自己的系统版本选择下载</span><span class=err>，</span><span class=nx>解压缩安装即可</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>https</span><span class=p>:</span><span class=c1>//github.com/protocolbuffers/protobuf/releases
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>解压缩安装包之后</span><span class=err>，</span><span class=nx>将</span> <span class=p>[</span><span class=nx>安装目录</span><span class=p>]</span><span class=o>/</span><span class=nx>bin</span> <span class=nx>目录</span><span class=err>，</span><span class=nx>添加到PATH环境变量</span><span class=err>。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=s>`protoc`</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//github.com/protocolbuffers/protobuf
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=o>-</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=nx>编译安装</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span> <span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=nx>直接安装编译好的包</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=22-安装编译器-go-语言插件>2.2 安装编译器 go 语言插件</h3><p>因为目前的 protoc 编译器，默认没有包含 go 语言代码生成器，所以需要单独安装插件</p><ul>
<li>(1) protoc-gen-go</li><li>(2) protoc-gen-go-grpc</li><li>(3) protoc-gen-go-micro</li><li>(4) protoc-gen-go-gateway</li><li>(5) protoc-gen-grpc-swagger</li></ul><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>swagger</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>golang</span><span class=o>/</span><span class=nx>protobuf</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=k>go</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=nx>google</span><span class=p>.</span><span class=nx>golang</span><span class=p>.</span><span class=nx>org</span><span class=o>/</span><span class=nx>protobuf</span><span class=o>/</span><span class=nx>cmd</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=k>go</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=k>go</span><span class=p>.</span><span class=nx>unistack</span><span class=p>.</span><span class=nx>org</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=k>go</span><span class=o>-</span><span class=nx>micro</span><span class=o>/</span><span class=nx>v3</span>
</span></span></code></pre></td></tr></table></div></div><p>安装 go 语言插件后，需要将 $GOPATH/bin 路径加入到 PATH 环境变量中。</p><h2 id=3-example-目录结构>3: Example 目录结构</h2><p>本教程例子的目录结构如下：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>helloworld</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>client</span><span class=p>.</span><span class=k>go</span> <span class=o>-</span> <span class=nx>客户端代码</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=k>go</span><span class=p>.</span><span class=nx>mod</span>  <span class=o>-</span> <span class=nx>go模块配置文件</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=nx>proto</span>     <span class=o>-</span> <span class=nx>协议目录</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=nx>helloworld</span><span class=p>.</span><span class=nx>pb</span><span class=p>.</span><span class=k>go</span> <span class=o>-</span> <span class=nx>rpc协议go版本代码</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>└──</span> <span class=nx>helloworld</span><span class=p>.</span><span class=nx>proto</span> <span class=o>-</span> <span class=nx>rpc协议文件</span>
</span></span><span class=line><span class=cl><span class=err>└──</span> <span class=nx>server</span><span class=p>.</span><span class=k>go</span>  <span class=o>-</span> <span class=nx>rpc服务端代码</span>
</span></span></code></pre></td></tr></table></div></div><p>初始化命令如下：</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=err>#</span> <span class=nx>创建项目目录</span>
</span></span><span class=line><span class=cl><span class=nx>mkdir</span> <span class=nx>helloworld</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>切换到项目目录</span>
</span></span><span class=line><span class=cl><span class=nx>cd</span> <span class=nx>helloworld</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>创建RPC协议目录</span>
</span></span><span class=line><span class=cl><span class=nx>mkdir</span> <span class=nx>proto</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>初始化go模块配置</span><span class=err>，</span><span class=nx>用来管理第三方依赖</span><span class=p>,</span> <span class=nx>本例子</span><span class=err>，</span><span class=nx>项目模块名是</span><span class=err>：</span><span class=nx>tizi365</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>helloworld</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>mod</span> <span class=nx>init</span> <span class=nx>tizi365</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>helloworld</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=4-定义服务>4: 定义服务</h2><blockquote>
<p>定义服务，其实就是通过 protobuf 语法定义语言平台无关的接口.</p></blockquote><p>文件: helloworld/proto/helloworld.proto</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c1>// 定义包名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>proto</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c1>// 定义Greeter服务
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>service</span> <span class=n>Greeter</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// 定义SayHello方法，接受HelloRequest消息， 并返回HelloReply消息
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>rpc</span> <span class=n>SayHello</span> <span class=p>(</span><span class=n>HelloRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>HelloReply</span><span class=p>)</span> <span class=p>{}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c1>// 定义HelloRequest消息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>message</span> <span class=nc>HelloRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// name字段
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c1>// 定义HelloReply消息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>message</span> <span class=nc>HelloReply</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// message字段
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=kd>message</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>Greeter 服务提供了一个 SayHello 接口，请求 SayHello 接口，需要传递一个包含 name 字段的 HelloRequest 消息，返回包含 message 字段的 HelloReply 消息。</p><h2 id=5-编译-proto-协议文件>5: 编译 proto 协议文件</h2><blockquote>
<p>上面通过 proto 定义的接口，没法直接在代码中使用，因此需要通过 protoc 编译器，将 proto 协议文件，编译成 go 语言代码。</p></blockquote><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=err>#</span> <span class=nx>切换到helloworld项目根目录</span><span class=err>，</span><span class=nx>执行命令</span>
</span></span><span class=line><span class=cl><span class=nx>protoc</span> <span class=o>-</span><span class=nx>I</span> <span class=nx>proto</span><span class=o>/</span> <span class=o>--</span><span class=nx>go_out</span><span class=p>=</span><span class=nx>plugins</span><span class=p>=</span><span class=nx>grpc</span><span class=p>:</span><span class=nx>proto</span> <span class=nx>proto</span><span class=o>/</span><span class=nx>helloworld</span><span class=p>.</span><span class=nx>proto</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// protoc命令参数说明:
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// -I 指定代码输出目录，忽略服务定义的包名，否则会根据包名创建目录
</span></span></span><span class=line><span class=cl><span class=c1>// --go_out 指定代码输出目录，格式：--go_out=plugins=grpc:目录名
</span></span></span><span class=line><span class=cl><span class=c1>// 命令最后面的参数是proto协议文件
</span></span></span></code></pre></td></tr></table></div></div><p>编译成功后在 proto 目录生成了 helloworld.pb.go 文件，里面包含了，我们的服务和接口定义。</p><h2 id=6-实现服务端代码>6: 实现服务端代码</h2><p>文件:helloworld/server.go</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;golang.org/x/net/context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 导入grpc包
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=s>&#34;google.golang.org/grpc&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 导入刚才我们生成的代码所在的proto包。
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>pb</span> <span class=s>&#34;tizi365.com/helloworld/proto&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;google.golang.org/grpc/reflection&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义server，用来实现proto文件，里面实现的Greeter服务里面的接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>server</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 实现SayHello接口
</span></span></span><span class=line><span class=cl><span class=c1>// 第一个参数是上下文参数，所有接口默认都要必填
</span></span></span><span class=line><span class=cl><span class=c1>// 第二个参数是我们定义的HelloRequest消息
</span></span></span><span class=line><span class=cl><span class=c1>// 返回值是我们定义的HelloReply消息，error返回值也是必须的。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>server</span><span class=p>)</span> <span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>in</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 创建一个HelloReply消息，设置Message字段，然后直接返回。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>{</span><span class=nx>Message</span><span class=p>:</span> <span class=s>&#34;Hello &#34;</span> <span class=o>+</span> <span class=nx>in</span><span class=p>.</span><span class=nx>Name</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 监听127.0.0.1:50051地址
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>lis</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Listen</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=s>&#34;127.0.0.1:50051&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to listen: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 实例化grpc服务端
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>s</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 注册Greeter服务
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>pb</span><span class=p>.</span><span class=nf>RegisterGreeterServer</span><span class=p>(</span><span class=nx>s</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>server</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 往grpc服务端注册反射服务
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>reflection</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 启动grpc服务
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nf>Serve</span><span class=p>(</span><span class=nx>lis</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to serve: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行服务:</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=err>#</span> <span class=nx>切换到项目根目录</span><span class=err>，</span><span class=nx>运行命令</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>run</span> <span class=nx>server</span><span class=p>.</span><span class=k>go</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=7实现客户端代码>7:实现客户端代码</h2><p>文件：helloworld/client.go</p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;golang.org/x/net/context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 导入grpc包
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=s>&#34;google.golang.org/grpc&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 导入刚才我们生成的代码所在的proto包。
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>pb</span> <span class=s>&#34;tizi365.com/helloworld/proto&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>defaultName</span> <span class=p>=</span> <span class=s>&#34;world&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 连接grpc服务器
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span><span class=s>&#34;localhost:50051&#34;</span><span class=p>,</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>WithInsecure</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;did not connect: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 延迟关闭连接
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>defer</span> <span class=nx>conn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 初始化Greeter服务客户端
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>c</span> <span class=o>:=</span> <span class=nx>pb</span><span class=p>.</span><span class=nf>NewGreeterClient</span><span class=p>(</span><span class=nx>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 初始化上下文，设置请求超时时间为1秒
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 延迟关闭请求会话
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 调用SayHello接口，发送一条消息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>r</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;world&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;could not greet: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 打印服务的返回的消息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Greeting: %s&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=err>#</span> <span class=nx>切换到项目根目录</span><span class=err>，</span><span class=nx>运行命令</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>run</span> <span class=nx>client</span><span class=p>.</span><span class=k>go</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=8-使用-grpc-gateway>8: 使用 grpc-gateway</h2><h3 id=81-安装-grpc-hateway>8.1 安装 grpc-hateway</h3><ul>
<li><a href=https://github.com/grpc-ecosystem/grpc-gateway>https://github.com/grpc-ecosystem/grpc-gateway</a></li></ul><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>swagger</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>golang</span><span class=o>/</span><span class=nx>protobuf</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=k>go</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>install</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>google</span><span class=o>/</span><span class=nx>gnostic</span><span class=o>/</span><span class=nx>cmd</span><span class=o>/</span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>openapi</span><span class=err>@</span><span class=nx>latest</span>
</span></span><span class=line><span class=cl><span class=c1>// go install github.com/go-kratos/kratos/cmd/protoc-gen-go-http/v2@latest
</span></span></span><span class=line><span class=cl><span class=c1>// go install github.com/go-kratos/kratos/cmd/protoc-gen-go-errors/v2@latest
</span></span></span><span class=line><span class=cl><span class=c1>// go install
</span></span></span><span class=line><span class=cl><span class=c1>// 上面执行成功后会在 $GOBIN (/usr/local/go/bin)目录下面 生成3个二进制文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span>
</span></span><span class=line><span class=cl><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>swagger</span>
</span></span><span class=line><span class=cl><span class=nx>protoc</span><span class=o>-</span><span class=nx>gen</span><span class=o>-</span><span class=k>go</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=82-修改-xproto-文件>8.2 修改 x.proto 文件</h2><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>syntax</span> <span class=p>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;google/api/annotations.proto&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>message</span> <span class=nx>HelloRequest</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=nx>name</span> <span class=p>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int32</span> <span class=nx>age</span> <span class=p>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>message</span> <span class=nx>HelloReply</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=nx>message</span> <span class=p>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>service</span> <span class=nx>HelloService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rpc</span> <span class=nf>SayHello</span> <span class=p>(</span><span class=nx>HelloRequest</span><span class=p>)</span> <span class=nf>returns</span> <span class=p>(</span><span class=nx>HelloReply</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>option</span> <span class=p>(</span><span class=nx>google</span><span class=p>.</span><span class=nx>api</span><span class=p>.</span><span class=nx>http</span><span class=p>)</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>post</span><span class=p>:</span><span class=s>&#34;/v1/examples/sayhello&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nx>body</span><span class=p>:</span><span class=s>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=83-生成-pbgo-代码>8.3 生成 pb.go 代码</h2><ul>
<li>生成<code>xxx.pb.go</code></li></ul><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>protoc</span> <span class=o>-</span><span class=nx>I</span><span class=p>.</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>local</span><span class=o>/</span><span class=nx>include</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>third_party</span><span class=o>/</span><span class=nx>googleapis</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=nx>go_out</span><span class=p>=</span><span class=nx>paths</span><span class=p>=</span><span class=nx>source_relative</span><span class=p>:.</span>  <span class=o>*</span><span class=p>.</span><span class=nx>proto</span>
</span></span></code></pre></td></tr></table></div></div><ul>
<li>生成<code>gw.pb.go</code></li></ul><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>protoc</span> <span class=o>-</span><span class=nx>I</span><span class=p>.</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>local</span><span class=o>/</span><span class=nx>include</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span> \
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>third_party</span><span class=o>/</span><span class=nx>googleapis</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway_out</span><span class=p>=</span><span class=nx>logtostderr</span><span class=p>=</span><span class=kc>true</span><span class=p>:.</span> <span class=o>*</span><span class=p>.</span><span class=nx>proto</span>
</span></span></code></pre></td></tr></table></div></div><ul>
<li>生成<code>swagger</code>,hello.swagger.json</li></ul><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>protoc</span> <span class=o>-</span><span class=nx>I</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>local</span><span class=o>/</span><span class=nx>include</span> <span class=o>-</span><span class=nx>I</span><span class=p>.</span> \
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span> \
</span></span><span class=line><span class=cl>  <span class=o>-</span><span class=nx>I</span><span class=err>$</span><span class=nx>GOPATH</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>ecosystem</span><span class=o>/</span><span class=nx>grpc</span><span class=o>-</span><span class=nx>gateway</span><span class=o>/</span><span class=nx>third_party</span><span class=o>/</span><span class=nx>googleapis</span> \
</span></span><span class=line><span class=cl>  <span class=o>--</span><span class=nx>swagger_out</span><span class=p>=</span><span class=nx>logtostderr</span><span class=p>=</span><span class=kc>true</span><span class=p>:.</span> <span class=o>*</span><span class=p>.</span><span class=nx>proto</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>lucas</span>
</p><p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2022-03-04
<a href=/commit/b3cbdf7868304aa509d9f828f40747898f749166 title=test>(b3cbdf7)</a>
</span>
</p></div><footer class=post-footer>
<div class=post-tags>
<a href=/tags/go/>Go</a>
</div><nav class=post-nav>
<a class=prev href=/post/linux/019-localhost%E4%B8%8E127.0.0.1%E4%B8%8E0.0.0.0%E4%B8%8E%E6%9C%AC%E6%9C%BAip%E7%9A%84%E5%8C%BA%E5%88%AB/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">01-localhost与127.0.0.1与0.0.0.0与本机IP的区别</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/rust/003-rust%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/>
<span class="next-text nav-default">01-Rust基本语法</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i>
</a>
</nav></footer></article></div></div></main><footer id=footer class=footer>
<div class=social-links>
<a href=mailto:golpp@qq.com class="iconfont icon-email" title=email></a>
<a href=http://localhost:1313 class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=http://localhost:1313 class="iconfont icon-twitter" title=twitter></a>
<a href=http://localhost:1313 class="iconfont icon-facebook" title=facebook></a>
<a href=https://github.com/lppgo class="iconfont icon-github" title=github></a>
<a href=http://localhost:1313 class="iconfont icon-weibo" title=weibo></a>
<a href=https://github.com/lppgo class="iconfont icon-gitlab" title=gitlab></a>
<a href=http://localhost:1313 class="iconfont icon-bilibili" title=bilibili></a>
<a href=https://lppgo.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div><div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
2015 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>李平平</span>
</span>
</div></footer><div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js></script>
<script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var e=document.createElement("script"),n,t;e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script>
</body></html>