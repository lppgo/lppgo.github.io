<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>006-Cpp webServer示例 - Even - A super concise theme for Hugo</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="lucas"><meta name=description content='Cpp webServer示例 1: 使用 c++11 标准库写一个 httpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 #include <iostream> #include <string> #include <sstream> #include <vector> #include <map> #include <thread> #include <mutex> #include <unistd.h> #include <arpa/inet.h> #include <sys/socket.h> #define Server_Port 18080 // 服务listen端口 // 定义 HTTP 请求方法 enum class HttpMethod { GET, POST }; // HTTP 请求结构体 struct HttpRequest { HttpMethod method; std::string url; std::map<std::string, std::string> headers; std::string body; }; // HTTP 响应结构体 struct HttpResponse { std::string status; std::map<std::string, std::string> headers; std::string body; }; // 处理 HTTP 请求 // void handleRequest(const HttpRequest& req, int clientSocket) { void handleRequest(int clientSocket) { HttpResponse res; // 构建 HTTP 响应 res.status = "HTTP/1.1 200 OK"; res.headers["Content-Type"] = "text/html"; res.body = "<html><body><h1>Hello, World!</h1></body></html>"; // 发送 HTTP 响应 std::ostringstream oss; oss << res.status << "\r\n"; for (const auto& header : res.headers) { oss << header.first << ": " << header.second << "\r\n"; } oss << "Content-Length: " << res.body.length() << "\r\n"; oss << "\r\n"; oss << res.body; std::string response = oss.str(); ssize_t n=write(clientSocket, response.c_str(), response.length()); // write用于将数据写入fd,返回值是成功写入的byte数 if(n<0){ std::cerr<<"Error writing response"<<std::endl; }else{ std::cout<<"Bytes written :"<<n<<std::endl; } close(clientSocket);// 关闭客户端连接 } // 启动 Web 服务器 void startWebServer() { int serverSocket, clientSocket; struct sockaddr_in serverAddr, clientAddr; socklen_t addrLen = sizeof(clientAddr); // 创建套接字 serverSocket = socket(AF_INET, SOCK_STREAM, 0); if (serverSocket == -1) { std::cerr << "Error creating socket" << std::endl; exit(1); } // 绑定地址和端口 serverAddr.sin_family = AF_INET; serverAddr.sin_addr.s_addr = INADDR_ANY; serverAddr.sin_port = htons(Server_Port); // 监听端口 if (bind(serverSocket, (struct sockaddr*)&amp;serverAddr, sizeof(serverAddr)) == -1) { std::cerr << "Error binding" << std::endl; close(serverSocket); exit(1); } // 监听连接 if (listen(serverSocket, 10) == -1) { std::cerr << "Error listening" << std::endl; close(serverSocket); exit(1); } std::cout << "Web server started at http://localhost:"<<Server_Port << std::endl; while (true) { // 接受客户端连接 clientSocket = accept(serverSocket, (struct sockaddr*)&amp;clientAddr, &amp;addrLen); if (clientSocket == -1) { std::cerr << "Error accepting connection" << std::endl; continue; } // 读取 HTTP 请求 char buffer[1024]; int bytesRead = read(clientSocket, buffer, sizeof(buffer)); if (bytesRead <=0){ std::cerr << "Error reading request" << std::endl; close(clientSocket); continue; } // 解析 HTTP 请求 std::string requestString(buffer, bytesRead); std::istringstream iss(requestString); std::string line; HttpRequest req; if (std::getline(iss, line)) { std::istringstream issLine(line); std::string methodStr, url; issLine >> methodStr >> url; if (methodStr == "GET") { req.method = HttpMethod::GET; } else if (methodStr == "POST") { req.method = HttpMethod::POST; } req.url = url; } while (std::getline(iss, line)) { size_t colonPos = line.find(&#39;:&#39;); if (colonPos != std::string::npos) { std::string key = line.substr(0, colonPos); std::string value = line.substr(colonPos + 1); req.headers[key] = value; } } handleRequest(clientSocket); // 处理 HTTP 请求 } // 关闭服务器套接字 close(serverSocket); } int main() { startWebServer(); return 0; } '><meta name=keywords content="C++,webserver,web"><meta name=generator content="Hugo 0.147.0 with theme even"><link rel=canonical href=https://lppgo.github.io/post/c++/006-cpp-webserver%E7%A4%BA%E4%BE%8B/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:url" content="https://lppgo.github.io/post/c++/006-cpp-webserver%E7%A4%BA%E4%BE%8B/"><meta property="og:site_name" content="Even - A super concise theme for Hugo"><meta property="og:title" content="006-Cpp webServer示例"><meta property="og:description" content='Cpp webServer示例 1: 使用 c++11 标准库写一个 httpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 #include <iostream> #include <string> #include <sstream> #include <vector> #include <map> #include <thread> #include <mutex> #include <unistd.h> #include <arpa/inet.h> #include <sys/socket.h> #define Server_Port 18080 // 服务listen端口 // 定义 HTTP 请求方法 enum class HttpMethod { GET, POST }; // HTTP 请求结构体 struct HttpRequest { HttpMethod method; std::string url; std::map<std::string, std::string> headers; std::string body; }; // HTTP 响应结构体 struct HttpResponse { std::string status; std::map<std::string, std::string> headers; std::string body; }; // 处理 HTTP 请求 // void handleRequest(const HttpRequest& req, int clientSocket) { void handleRequest(int clientSocket) { HttpResponse res; // 构建 HTTP 响应 res.status = "HTTP/1.1 200 OK"; res.headers["Content-Type"] = "text/html"; res.body = "<html><body><h1>Hello, World!</h1></body></html>"; // 发送 HTTP 响应 std::ostringstream oss; oss << res.status << "\r\n"; for (const auto& header : res.headers) { oss << header.first << ": " << header.second << "\r\n"; } oss << "Content-Length: " << res.body.length() << "\r\n"; oss << "\r\n"; oss << res.body; std::string response = oss.str(); ssize_t n=write(clientSocket, response.c_str(), response.length()); // write用于将数据写入fd,返回值是成功写入的byte数 if(n<0){ std::cerr<<"Error writing response"<<std::endl; }else{ std::cout<<"Bytes written :"<<n<<std::endl; } close(clientSocket);// 关闭客户端连接 } // 启动 Web 服务器 void startWebServer() { int serverSocket, clientSocket; struct sockaddr_in serverAddr, clientAddr; socklen_t addrLen = sizeof(clientAddr); // 创建套接字 serverSocket = socket(AF_INET, SOCK_STREAM, 0); if (serverSocket == -1) { std::cerr << "Error creating socket" << std::endl; exit(1); } // 绑定地址和端口 serverAddr.sin_family = AF_INET; serverAddr.sin_addr.s_addr = INADDR_ANY; serverAddr.sin_port = htons(Server_Port); // 监听端口 if (bind(serverSocket, (struct sockaddr*)&amp;serverAddr, sizeof(serverAddr)) == -1) { std::cerr << "Error binding" << std::endl; close(serverSocket); exit(1); } // 监听连接 if (listen(serverSocket, 10) == -1) { std::cerr << "Error listening" << std::endl; close(serverSocket); exit(1); } std::cout << "Web server started at http://localhost:"<<Server_Port << std::endl; while (true) { // 接受客户端连接 clientSocket = accept(serverSocket, (struct sockaddr*)&amp;clientAddr, &amp;addrLen); if (clientSocket == -1) { std::cerr << "Error accepting connection" << std::endl; continue; } // 读取 HTTP 请求 char buffer[1024]; int bytesRead = read(clientSocket, buffer, sizeof(buffer)); if (bytesRead <=0){ std::cerr << "Error reading request" << std::endl; close(clientSocket); continue; } // 解析 HTTP 请求 std::string requestString(buffer, bytesRead); std::istringstream iss(requestString); std::string line; HttpRequest req; if (std::getline(iss, line)) { std::istringstream issLine(line); std::string methodStr, url; issLine >> methodStr >> url; if (methodStr == "GET") { req.method = HttpMethod::GET; } else if (methodStr == "POST") { req.method = HttpMethod::POST; } req.url = url; } while (std::getline(iss, line)) { size_t colonPos = line.find(&#39;:&#39;); if (colonPos != std::string::npos) { std::string key = line.substr(0, colonPos); std::string value = line.substr(colonPos + 1); req.headers[key] = value; } } handleRequest(clientSocket); // 处理 HTTP 请求 } // 关闭服务器套接字 close(serverSocket); } int main() { startWebServer(); return 0; }'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-04-17T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-17T00:00:00+00:00"><meta property="article:tag" content="C++"><meta itemprop=name content="006-Cpp webServer示例"><meta itemprop=description content='Cpp webServer示例 1: 使用 c++11 标准库写一个 httpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 #include <iostream> #include <string> #include <sstream> #include <vector> #include <map> #include <thread> #include <mutex> #include <unistd.h> #include <arpa/inet.h> #include <sys/socket.h> #define Server_Port 18080 // 服务listen端口 // 定义 HTTP 请求方法 enum class HttpMethod { GET, POST }; // HTTP 请求结构体 struct HttpRequest { HttpMethod method; std::string url; std::map<std::string, std::string> headers; std::string body; }; // HTTP 响应结构体 struct HttpResponse { std::string status; std::map<std::string, std::string> headers; std::string body; }; // 处理 HTTP 请求 // void handleRequest(const HttpRequest& req, int clientSocket) { void handleRequest(int clientSocket) { HttpResponse res; // 构建 HTTP 响应 res.status = "HTTP/1.1 200 OK"; res.headers["Content-Type"] = "text/html"; res.body = "<html><body><h1>Hello, World!</h1></body></html>"; // 发送 HTTP 响应 std::ostringstream oss; oss << res.status << "\r\n"; for (const auto& header : res.headers) { oss << header.first << ": " << header.second << "\r\n"; } oss << "Content-Length: " << res.body.length() << "\r\n"; oss << "\r\n"; oss << res.body; std::string response = oss.str(); ssize_t n=write(clientSocket, response.c_str(), response.length()); // write用于将数据写入fd,返回值是成功写入的byte数 if(n<0){ std::cerr<<"Error writing response"<<std::endl; }else{ std::cout<<"Bytes written :"<<n<<std::endl; } close(clientSocket);// 关闭客户端连接 } // 启动 Web 服务器 void startWebServer() { int serverSocket, clientSocket; struct sockaddr_in serverAddr, clientAddr; socklen_t addrLen = sizeof(clientAddr); // 创建套接字 serverSocket = socket(AF_INET, SOCK_STREAM, 0); if (serverSocket == -1) { std::cerr << "Error creating socket" << std::endl; exit(1); } // 绑定地址和端口 serverAddr.sin_family = AF_INET; serverAddr.sin_addr.s_addr = INADDR_ANY; serverAddr.sin_port = htons(Server_Port); // 监听端口 if (bind(serverSocket, (struct sockaddr*)&amp;serverAddr, sizeof(serverAddr)) == -1) { std::cerr << "Error binding" << std::endl; close(serverSocket); exit(1); } // 监听连接 if (listen(serverSocket, 10) == -1) { std::cerr << "Error listening" << std::endl; close(serverSocket); exit(1); } std::cout << "Web server started at http://localhost:"<<Server_Port << std::endl; while (true) { // 接受客户端连接 clientSocket = accept(serverSocket, (struct sockaddr*)&amp;clientAddr, &amp;addrLen); if (clientSocket == -1) { std::cerr << "Error accepting connection" << std::endl; continue; } // 读取 HTTP 请求 char buffer[1024]; int bytesRead = read(clientSocket, buffer, sizeof(buffer)); if (bytesRead <=0){ std::cerr << "Error reading request" << std::endl; close(clientSocket); continue; } // 解析 HTTP 请求 std::string requestString(buffer, bytesRead); std::istringstream iss(requestString); std::string line; HttpRequest req; if (std::getline(iss, line)) { std::istringstream issLine(line); std::string methodStr, url; issLine >> methodStr >> url; if (methodStr == "GET") { req.method = HttpMethod::GET; } else if (methodStr == "POST") { req.method = HttpMethod::POST; } req.url = url; } while (std::getline(iss, line)) { size_t colonPos = line.find(&#39;:&#39;); if (colonPos != std::string::npos) { std::string key = line.substr(0, colonPos); std::string value = line.substr(colonPos + 1); req.headers[key] = value; } } handleRequest(clientSocket); // 处理 HTTP 请求 } // 关闭服务器套接字 close(serverSocket); } int main() { startWebServer(); return 0; }'><meta itemprop=datePublished content="2023-04-17T00:00:00+00:00"><meta itemprop=dateModified content="2021-04-17T00:00:00+00:00"><meta itemprop=wordCount content="670"><meta itemprop=keywords content="C++,webserver,web"><meta name=twitter:card content="summary"><meta name=twitter:title content="006-Cpp webServer示例"><meta name=twitter:description content='Cpp webServer示例 1: 使用 c++11 标准库写一个 httpServer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 #include <iostream> #include <string> #include <sstream> #include <vector> #include <map> #include <thread> #include <mutex> #include <unistd.h> #include <arpa/inet.h> #include <sys/socket.h> #define Server_Port 18080 // 服务listen端口 // 定义 HTTP 请求方法 enum class HttpMethod { GET, POST }; // HTTP 请求结构体 struct HttpRequest { HttpMethod method; std::string url; std::map<std::string, std::string> headers; std::string body; }; // HTTP 响应结构体 struct HttpResponse { std::string status; std::map<std::string, std::string> headers; std::string body; }; // 处理 HTTP 请求 // void handleRequest(const HttpRequest& req, int clientSocket) { void handleRequest(int clientSocket) { HttpResponse res; // 构建 HTTP 响应 res.status = "HTTP/1.1 200 OK"; res.headers["Content-Type"] = "text/html"; res.body = "<html><body><h1>Hello, World!</h1></body></html>"; // 发送 HTTP 响应 std::ostringstream oss; oss << res.status << "\r\n"; for (const auto& header : res.headers) { oss << header.first << ": " << header.second << "\r\n"; } oss << "Content-Length: " << res.body.length() << "\r\n"; oss << "\r\n"; oss << res.body; std::string response = oss.str(); ssize_t n=write(clientSocket, response.c_str(), response.length()); // write用于将数据写入fd,返回值是成功写入的byte数 if(n<0){ std::cerr<<"Error writing response"<<std::endl; }else{ std::cout<<"Bytes written :"<<n<<std::endl; } close(clientSocket);// 关闭客户端连接 } // 启动 Web 服务器 void startWebServer() { int serverSocket, clientSocket; struct sockaddr_in serverAddr, clientAddr; socklen_t addrLen = sizeof(clientAddr); // 创建套接字 serverSocket = socket(AF_INET, SOCK_STREAM, 0); if (serverSocket == -1) { std::cerr << "Error creating socket" << std::endl; exit(1); } // 绑定地址和端口 serverAddr.sin_family = AF_INET; serverAddr.sin_addr.s_addr = INADDR_ANY; serverAddr.sin_port = htons(Server_Port); // 监听端口 if (bind(serverSocket, (struct sockaddr*)&amp;serverAddr, sizeof(serverAddr)) == -1) { std::cerr << "Error binding" << std::endl; close(serverSocket); exit(1); } // 监听连接 if (listen(serverSocket, 10) == -1) { std::cerr << "Error listening" << std::endl; close(serverSocket); exit(1); } std::cout << "Web server started at http://localhost:"<<Server_Port << std::endl; while (true) { // 接受客户端连接 clientSocket = accept(serverSocket, (struct sockaddr*)&amp;clientAddr, &amp;addrLen); if (clientSocket == -1) { std::cerr << "Error accepting connection" << std::endl; continue; } // 读取 HTTP 请求 char buffer[1024]; int bytesRead = read(clientSocket, buffer, sizeof(buffer)); if (bytesRead <=0){ std::cerr << "Error reading request" << std::endl; close(clientSocket); continue; } // 解析 HTTP 请求 std::string requestString(buffer, bytesRead); std::istringstream iss(requestString); std::string line; HttpRequest req; if (std::getline(iss, line)) { std::istringstream issLine(line); std::string methodStr, url; issLine >> methodStr >> url; if (methodStr == "GET") { req.method = HttpMethod::GET; } else if (methodStr == "POST") { req.method = HttpMethod::POST; } req.url = url; } while (std::getline(iss, line)) { size_t colonPos = line.find(&#39;:&#39;); if (colonPos != std::string::npos) { std::string key = line.substr(0, colonPos); std::string value = line.substr(colonPos + 1); req.headers[key] = value; } } handleRequest(clientSocket); // 处理 HTTP 请求 } // 关闭服务器套接字 close(serverSocket); } int main() { startWebServer(); return 0; }'><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>lppgo</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>lppgo</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>006-Cpp webServer示例</h1><div class=post-meta><span class=post-time>2023-04-17</span><div class=post-category><a href=/categories/c++/>C++</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#1-使用-c11-标准库写一个-httpserver>1: 使用 c++11 标准库写一个 httpServer</a></li></ul></nav></div></div><div class=post-content><div align=center><font size=50>Cpp webServer示例</font></div><h1 id=1-使用-c11-标准库写一个-httpserver>1: 使用 c++11 标准库写一个 httpServer</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;map&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;thread&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;mutex&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;arpa/inet.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/socket.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define Server_Port  18080  </span><span class=c1>// 服务listen端口
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 定义 HTTP 请求方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=k>class</span> <span class=nc>HttpMethod</span> <span class=p>{</span> <span class=n>GET</span><span class=p>,</span> <span class=n>POST</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// HTTP 请求结构体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>HttpRequest</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpMethod</span> <span class=n>method</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>headers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// HTTP 响应结构体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>HttpResponse</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>headers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 处理 HTTP 请求
</span></span></span><span class=line><span class=cl><span class=c1>// void handleRequest(const HttpRequest&amp; req, int clientSocket) {
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>handleRequest</span><span class=p>(</span><span class=kt>int</span> <span class=n>clientSocket</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpResponse</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 构建 HTTP 响应
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>res</span><span class=p>.</span><span class=n>status</span> <span class=o>=</span> <span class=s>&#34;HTTP/1.1 200 OK&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>.</span><span class=n>headers</span><span class=p>[</span><span class=s>&#34;Content-Type&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;text/html&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>.</span><span class=n>body</span> <span class=o>=</span> <span class=s>&#34;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, World!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 发送 HTTP 响应
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span> <span class=n>oss</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>oss</span> <span class=o>&lt;&lt;</span> <span class=n>res</span><span class=p>.</span><span class=n>status</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=nl>header</span> <span class=p>:</span> <span class=n>res</span><span class=p>.</span><span class=n>headers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>oss</span> <span class=o>&lt;&lt;</span> <span class=n>header</span><span class=p>.</span><span class=n>first</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>header</span><span class=p>.</span><span class=n>second</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>oss</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Content-Length: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>res</span><span class=p>.</span><span class=n>body</span><span class=p>.</span><span class=n>length</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>oss</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\r\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>oss</span> <span class=o>&lt;&lt;</span> <span class=n>res</span><span class=p>.</span><span class=n>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>response</span> <span class=o>=</span> <span class=n>oss</span><span class=p>.</span><span class=n>str</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>ssize_t</span> <span class=n>n</span><span class=o>=</span><span class=n>write</span><span class=p>(</span><span class=n>clientSocket</span><span class=p>,</span> <span class=n>response</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>response</span><span class=p>.</span><span class=n>length</span><span class=p>());</span> <span class=c1>// write用于将数据写入fd,返回值是成功写入的byte数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>n</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span><span class=o>&lt;&lt;</span><span class=s>&#34;Error writing response&#34;</span><span class=o>&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=o>&lt;&lt;</span><span class=s>&#34;Bytes written :&#34;</span><span class=o>&lt;&lt;</span><span class=n>n</span><span class=o>&lt;&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>close</span><span class=p>(</span><span class=n>clientSocket</span><span class=p>);</span><span class=c1>// 关闭客户端连接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 启动 Web 服务器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>startWebServer</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>serverSocket</span><span class=p>,</span> <span class=n>clientSocket</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>sockaddr_in</span> <span class=n>serverAddr</span><span class=p>,</span> <span class=n>clientAddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>socklen_t</span> <span class=n>addrLen</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>clientAddr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建套接字
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>serverSocket</span> <span class=o>=</span> <span class=n>socket</span><span class=p>(</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>SOCK_STREAM</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>serverSocket</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error creating socket&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 绑定地址和端口
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>serverAddr</span><span class=p>.</span><span class=n>sin_family</span> <span class=o>=</span> <span class=n>AF_INET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>serverAddr</span><span class=p>.</span><span class=n>sin_addr</span><span class=p>.</span><span class=n>s_addr</span> <span class=o>=</span> <span class=n>INADDR_ANY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>serverAddr</span><span class=p>.</span><span class=n>sin_port</span> <span class=o>=</span> <span class=n>htons</span><span class=p>(</span><span class=n>Server_Port</span><span class=p>);</span> <span class=c1>// 监听端口
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>bind</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>,</span> <span class=p>(</span><span class=k>struct</span> <span class=nc>sockaddr</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>serverAddr</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>serverAddr</span><span class=p>))</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error binding&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>close</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 监听连接
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>listen</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error listening&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>close</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Web server started at http://localhost:&#34;</span><span class=o>&lt;&lt;</span><span class=n>Server_Port</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 接受客户端连接
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>clientSocket</span> <span class=o>=</span> <span class=n>accept</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>,</span> <span class=p>(</span><span class=k>struct</span> <span class=nc>sockaddr</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>clientAddr</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>addrLen</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>clientSocket</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error accepting connection&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 读取 HTTP 请求
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>bytesRead</span> <span class=o>=</span> <span class=n>read</span><span class=p>(</span><span class=n>clientSocket</span><span class=p>,</span> <span class=n>buffer</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buffer</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>bytesRead</span> <span class=o>&lt;=</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error reading request&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>close</span><span class=p>(</span><span class=n>clientSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 解析 HTTP 请求
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>requestString</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>bytesRead</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>istringstream</span> <span class=n>iss</span><span class=p>(</span><span class=n>requestString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>line</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>HttpRequest</span> <span class=n>req</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>getline</span><span class=p>(</span><span class=n>iss</span><span class=p>,</span> <span class=n>line</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>istringstream</span> <span class=n>issLine</span><span class=p>(</span><span class=n>line</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>methodStr</span><span class=p>,</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>issLine</span> <span class=o>&gt;&gt;</span> <span class=n>methodStr</span> <span class=o>&gt;&gt;</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>methodStr</span> <span class=o>==</span> <span class=s>&#34;GET&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>req</span><span class=p>.</span><span class=n>method</span> <span class=o>=</span> <span class=n>HttpMethod</span><span class=o>::</span><span class=n>GET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>methodStr</span> <span class=o>==</span> <span class=s>&#34;POST&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>req</span><span class=p>.</span><span class=n>method</span> <span class=o>=</span> <span class=n>HttpMethod</span><span class=o>::</span><span class=n>POST</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>req</span><span class=p>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>getline</span><span class=p>(</span><span class=n>iss</span><span class=p>,</span> <span class=n>line</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>size_t</span> <span class=n>colonPos</span> <span class=o>=</span> <span class=n>line</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=sc>&#39;:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>colonPos</span> <span class=o>!=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>::</span><span class=n>npos</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>key</span> <span class=o>=</span> <span class=n>line</span><span class=p>.</span><span class=n>substr</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>colonPos</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>value</span> <span class=o>=</span> <span class=n>line</span><span class=p>.</span><span class=n>substr</span><span class=p>(</span><span class=n>colonPos</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>req</span><span class=p>.</span><span class=n>headers</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>handleRequest</span><span class=p>(</span><span class=n>clientSocket</span><span class=p>);</span> <span class=c1>// 处理 HTTP 请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 关闭服务器套接字
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>close</span><span class=p>(</span><span class=n>serverSocket</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>startWebServer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>lucas</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-04-17</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/c++/>C++</a></div><nav class=post-nav><a class=prev href=/post/c++/007-cpp-%E7%9A%84-debug-%E5%B7%A5%E5%85%B7dbg-macro/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">007-Cpp debug 工具dbg-macro</span>
<span class="prev-text nav-mobile">上一篇</span>
</a><a class=next href=/post/c++/005-cpp-%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%87%BD%E6%95%B0/><span class="next-text nav-default">005-Cpp 动态内存分配函数</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:golpp@qq.com class="iconfont icon-email" title=email></a><a href=http://localhost:1313 class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=http://localhost:1313 class="iconfont icon-twitter" title=twitter></a><a href=http://localhost:1313 class="iconfont icon-facebook" title=facebook></a><a href=https://github.com/lppgo class="iconfont icon-github" title=github></a><a href=http://localhost:1313 class="iconfont icon-weibo" title=weibo></a><a href=https://github.com/lppgo class="iconfont icon-gitlab" title=gitlab></a><a href=http://localhost:1313 class="iconfont icon-bilibili" title=bilibili></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span><span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span><span class=copyright-year>&copy;
2015 -
2025<span class=heart><i class="iconfont icon-heart"></i></span><span></span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script><script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>